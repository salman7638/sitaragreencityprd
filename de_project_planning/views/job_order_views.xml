<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Purchase Requisition -->        
        <record model="ir.actions.act_window" id="action_job_order_to_pr">
            <field name="name">Request for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.requisition</field>
            <field name="view_mode">form,tree</field>
            <field name="domain">[('task_id','=',active_id)]</field>
            <field name="context">{
                "default_task_id":active_id,
                "default_user_id": False,
                }
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="action_jo_purchase_requisition_list">
            <field name="name">Purchase Requisitions</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.requisition</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('task_id','=',active_id)]</field>
            <field name="context">{
                "default_task_id":active_id,
                "default_user_id": False,
                }
            </field>
        </record>
        
        <!-- Stock Picking -->        
        <record model="ir.actions.act_window" id="action_job_order_to_ir">
            <field name="name">Internal Requisition</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.picking</field>
            <field name="view_mode">form,tree</field>
            <field name="domain">[('task_id','=',active_id)]</field>
            <field name="context">{
                "default_task_id":active_id,
                "default_user_id": False,
                }
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="action_jo_picking_list">
            <field name="name">Internal Requisitions</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.picking</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('task_id','=',active_id)]</field>
            <field name="context">{
                "default_task_id":active_id,
                "default_user_id": False,
                }
            </field>
        </record>
        
        <!-- inherit task form view -->
        <record id="view_task_form2_inherit_job_order" model="ir.ui.view">
            <field name="name">view.task.form2.inherit.job.order</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2" />
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <button name="%(action_job_order_to_pr)d" type="action" class="oe_highlight"
                    string="Purchase Requisition" />
                    <button name="%(action_job_order_to_ir)d" type="action" class="oe_highlight"
                    string="Internal Transfer"  />
                    
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button class="oe_stat_button" type="action" name="%(act_project_task_note_all)d" icon="fa-pencil-square-o">
                        <field string="Notes" name="task_notes_count" widget="statinfo" />

                    </button>
                    
                    <button name="%(action_jo_purchase_requisition_list)d" type="action" class="oe_stat_button" icon="fa-list-alt" attrs="{'invisible':[('requisition_count','=',0)]}">
                        <field name="requisition_count" widget="statinfo" string="Purchase Requisitions"/>
                    </button>
                    <button name="%(action_jo_picking_list)d" type="action" class="oe_stat_button" icon="fa-truck" attrs="{'invisible':[('picking_count','=',0)]}">
                        <field name="picking_count" widget="statinfo" string="Pickings"/>
                    </button>
                    
                    <button type="object"
                        name="action_view_move_lines"
                        class="oe_stat_button"
                        icon="fa-truck"
                        attrs="{'invisible': [('move_line_count', '=', 0)]}" >
                        <field name="move_line_count" widget="statinfo" string="Product Moves"/>
                    </button>
                    
                </xpath>
                
                <xpath expr="//page[@name='extra_info']/group[1]/group[1]" position="inside">
                    <field name="allow_site_planning" invisible="1"/>
                    <field name="location_id" />
                    <field name="picking_type_id" />
                    <field name="is_job_order" />
                    <field name="project_cost_sheet_id" />
                </xpath>
                <xpath expr="//page[@name='description_page']" position="after">
                    <page name='material_planing' string='Material Planning' attrs="{'invisible': [('is_job_order', '!=', True)]}">
                        <field name="project_task_material_line" widget="one2many_list">
                            <tree string="Material lines" editable="bottom" decoration-danger="qty_available &lt; 0" decoration-success="qty_available &gt; 0" >
                                <field name="requisition_action"/>
                                <field name="product_id"/>
                                <field name="product_template_id" invisible="1"/>
                                <field name="name"/>
                                <field name="product_uom"/>
                                <field name="product_uom_qty" string="Planned Qty" sum="Planned Qty"/>
                                <field name="qty_available"/>
                                <field name="product_uom_category_id" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    
                </xpath>
                
            </field>
        </record>
        <record id="view_task_form2_inherited_job_type" model="ir.ui.view">
            <field name="name">view.task.form2.inherit.job.type</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="hr_timesheet.view_task_form2_inherited" />
            <field name="arch" type="xml">
                <xpath expr="//page[@id='timesheets_tab']" position="inside">
                    <field name="allow_site_planning" invisible="1" />
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/tree//field[@name='user_id']" position="before">
                    <field name="job_type_id" options="{'no_create':True,'no_open':True}" attrs="{'column_invisible':[('parent.allow_site_planning','!=', True)],'required':[('parent.allow_site_planning','=',True)]}"/>
                </xpath>
            </field>
        </record>
        <record id="action_view_all_job_orders" model="ir.actions.act_window">
            <field name="name">Job Orders</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="context">{'search_default_my_tasks': 1, 'all_task': 0, 'is_job_order': '1'}</field>
            <field name="domain">[('is_job_order','=', True)]</field>
            <field name="search_view_id" ref="project.view_task_search_form"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No job orders found. Let's create one!
                </p>
            </field>
        </record>
        
        <menuitem name="Job Order" id="project_planning_job_order_menu" parent="project_planning_ops_main_menu" action="action_view_all_job_orders" sequence="20" groups="base.group_no_one,project.group_project_user"/>
        
        
        
    </data>
</odoo>